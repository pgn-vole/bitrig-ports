$OpenBSD: patch-libmysql_CMakeLists_txt,v 1.10 2015/04/09 06:58:12 giovanni Exp $
--- libmysql/CMakeLists.txt.orig	Wed Feb 25 10:40:54 2015
+++ libmysql/CMakeLists.txt	Mon Mar  2 23:11:35 2015
@@ -266,6 +266,8 @@ mysql_net_field_length
 mysql_options4
 )
 
+SET(LIBVER_OVERRIDE $ENV{LIBmysqlclient_VERSION})
+
 SET(CLIENT_API_FUNCTIONS
   ${CLIENT_API_FUNCTIONS_5_1}
   ${CLIENT_API_FUNCTIONS_5_5}
@@ -441,8 +443,12 @@ IF(NOT DISABLE_SHARED)
     # libtool compatability
     IF(CMAKE_SYSTEM_NAME MATCHES "FreeBSD" OR APPLE)
       SET(OS_SHARED_LIB_VERSION "${SHARED_LIB_MAJOR_VERSION}")
-    ELSEIF(CMAKE_SYSTEM_NAME MATCHES "HP-UX")
-      SET(OS_SHARED_LIB_VERSION "${SHARED_LIB_MAJOR_VERSION}.0")
+    ELSEIF(CMAKE_SYSTEM_NAME MATCHES "HP-UX" OR CMAKE_SYSTEM_NAME MATCHES "OpenBSD")
+      IF(LIBVER_OVERRIDE)
+        SET(OS_SHARED_LIB_VERSION "${LIBVER_OVERRIDE}")
+      ELSE()
+        SET(OS_SHARED_LIB_VERSION "${SHARED_LIB_MAJOR_VERSION}.0")
+      ENDIF(LIBVER_OVERRIDE)
     ELSE()
       SET(OS_SHARED_LIB_VERSION "${SHARED_LIB_MAJOR_VERSION}.0.0")
     ENDIF()
@@ -450,7 +456,7 @@ IF(NOT DISABLE_SHARED)
     SET_TARGET_PROPERTIES(libmysql PROPERTIES 
       OUTPUT_NAME mysqlclient 
       VERSION "${OS_SHARED_LIB_VERSION}" 
-      SOVERSION "${SHARED_LIB_MAJOR_VERSION}")
+      SOVERSION "${OS_SHARED_LIB_VERSION}")
     IF(LINK_FLAG_NO_UNDEFINED OR VERSION_SCRIPT_LINK_FLAGS)
       GET_TARGET_PROPERTY(libmysql_link_flags libmysql LINK_FLAGS)
       IF(NOT libmysql_link_flags)
@@ -469,18 +475,8 @@ IF(NOT DISABLE_SHARED)
     GET_VERSIONED_LIBNAME(
       "${CMAKE_SHARED_LIBRARY_PREFIX}mysqlclient_r"
       "${CMAKE_SHARED_LIBRARY_SUFFIX}"
-      ""
+      "${OS_SHARED_LIB_VERSION}"
       linkname)
-    INSTALL_SYMLINK(${linkname} libmysql ${INSTALL_LIBDIR} SharedLibraries)
-    SET(OS_SHARED_LIB_SYMLINKS "${SHARED_LIB_MAJOR_VERSION}" "${OS_SHARED_LIB_VERSION}")
-    LIST(REMOVE_DUPLICATES OS_SHARED_LIB_SYMLINKS)
-    FOREACH(ver ${OS_SHARED_LIB_SYMLINKS})
-      GET_VERSIONED_LIBNAME(
-        "${CMAKE_SHARED_LIBRARY_PREFIX}mysqlclient_r"
-        "${CMAKE_SHARED_LIBRARY_SUFFIX}"
-        "${ver}"
-        linkname)
-      INSTALL_SYMLINK(${linkname} libmysql ${INSTALL_LIBDIR} SharedLibraries)
-    ENDFOREACH()
+    INSTALL_VERSIONED_SYMLINK(${linkname} libmysql ${INSTALL_LIBDIR} SharedLibraries)
   ENDIF()
 ENDIF()
