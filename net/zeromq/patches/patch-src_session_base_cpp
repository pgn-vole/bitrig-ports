$OpenBSD: patch-src_session_base_cpp,v 1.1 2015/05/13 05:08:26 jasper Exp $

Security fix for V3 protocol downgrade
https://github.com/zeromq/libzmq/issues/1273

--- src/session_base.cpp.orig	Tue Oct 14 10:06:40 2014
+++ src/session_base.cpp	Tue May 12 09:04:21 2015
@@ -323,6 +323,14 @@ int zmq::session_base_t::zap_connect ()
     return 0;
 }
 
+bool zmq::session_base_t::zap_enabled ()
+{
+    return (
+         options.mechanism != ZMQ_NULL ||
+        (options.mechanism == ZMQ_NULL && options.zap_domain.length() > 0)
+    );
+}
+
 void zmq::session_base_t::process_attach (i_engine *engine_)
 {
     zmq_assert (engine_ != NULL);
