# $OpenBSD: Makefile,v 1.36 2015/04/14 14:17:47 sthen Exp $

COMMENT=	monitor arp & rarp requests

DISTNAME=	arpwatch-2.1a15
# oui-iab file generated by "make listing" in ports/net/arp-scan
DISTFILES=	${DISTNAME}${EXTRACT_SUFX} \
		oui-iab-20150414.tar.bz2:0
REVISION=	11
CATEGORIES=	net

MASTER_SITES=	ftp://ftp.ee.lbl.gov/
MASTER_SITES0=	http://spacehopper.org/mirrors/

PERMIT_PACKAGE_CDROM=	Yes

WANTLIB=		c pcap

CONFIGURE_STYLE=	gnu
CONFIGURE_ARGS=		--quiet
MAKE_FLAGS+=		ARPDIR=/var/arpwatch

USE_GROFF=	Yes
NO_TEST=	Yes

EXAMPLESDIR=	${PREFIX}/share/examples/arpwatch

pre-configure:
	cd ${WRKSRC}; chmod u+w ${WRKSRC}/ethercodes.dat; \
	    ./massagevendor < ../oui-iab/oui.txt > ethercodes.dat

do-install:
	@perl -pi -e 's,awk -f ,awk -f ${EXAMPLESDIR}/', ${WRKSRC}/massagevendor
	${INSTALL_PROGRAM} ${WRKSRC}/arpwatch ${PREFIX}/sbin
	${INSTALL_PROGRAM} ${WRKSRC}/arpsnmp ${PREFIX}/sbin
	${INSTALL_MAN} ${WRKSRC}/arpwatch.8 ${PREFIX}/man/man8
	${INSTALL_MAN} ${WRKSRC}/arpsnmp.8 ${PREFIX}/man/man8
	${INSTALL_DATA_DIR} ${EXAMPLESDIR}
	@for i in ethercodes.dat *.awk; do \
		${INSTALL_DATA} ${WRKSRC}/$$i ${EXAMPLESDIR}; \
	done
	@${INSTALL_DATA} /dev/null ${EXAMPLESDIR}/arp.dat
	@${INSTALL_SCRIPT} ${WRKSRC}/arp2ethers ${EXAMPLESDIR}
	@${INSTALL_SCRIPT} ${WRKSRC}/massagevendor ${EXAMPLESDIR}

.include <bsd.port.mk>
