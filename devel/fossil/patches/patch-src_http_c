$OpenBSD: patch-src_http_c,v 1.1 2015/05/08 00:00:32 jturner Exp $

Fix user-after free, fixed upstream df12c1b05318862f0c78fb86591c1850e059853e

--- src/http.c.orig	Thu May  7 19:52:55 2015
+++ src/http.c	Thu May  7 19:54:34 2015
@@ -340,10 +340,10 @@ int http_exchange(Blob *pSend, Blob *pReply, int useLo
          j -= 4;
          zLine[j] = 0;
       }
-      transport_close(&g.url);
-      transport_global_shutdown(&g.url);
       fossil_print("redirect with status %d to %s\n", rc, &zLine[i]);
       url_parse(&zLine[i], 0);
+      transport_close(&g.url);
+      transport_global_shutdown(&g.url);
       fSeenHttpAuth = 0;
       if( g.zHttpAuth ) free(g.zHttpAuth);
       g.zHttpAuth = get_httpauth();
